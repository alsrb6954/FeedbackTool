extends ../layout

block content
  .container
    .main-feedback
        div 
            #pdfName=feedback.fileUp
            button#prev(onclick='prevChange();') Previous
            button#next(onclick='nextChange();') Next
            span.pagenumber
                | Page: 
                span#page_num
                |  / 
                span#page_count
            a.fa.fa-download.download(aria-hidden='true' onclick='downloadFiles("#{feedback.fileUp}");')
        canvas#the-canvas
        br
        a.btn.btn-lg.btn-danger.btn-exit(href='javascript:window.history.back();') 종료
    .main-offerfeedback
        div
            h1 Feedback 
            .comment
                textarea.form-control#feedbackComment(rows="10", cols="45")
            br
            a.btn.btn-primary(onclick='saveComment();') 게시



    script(src='//mozilla.github.io/pdf.js/build/pdf.js')
    script(src='/javascripts/pdfShow.js')
    script(src='/javascripts/main.js')

    script(type='text/javascript').
        function saveComment() {
            var page_num = document.getElementById("page_num").innerHTML;
            var feedbackComment = document.getElementById("feedbackComment").value;
            $.get('/feedbacks/comment?id=#{feedback._id}&page_num='+page_num+'&feedbackComment='+feedbackComment, function() { 
            });

            $.ajax({
                url: '/feedbacks/comment?id=#{feedback._id}&page_num='+page_num+'&feedbackComment='+feedbackComment,
                type: "get",
                success: function() {
                }
            });
        }
        function nextChange() {
            var page_num = document.getElementById("page_num").innerHTML;
            var page = ++page_num;
            $.get('/feedbacks/page?id=#{feedback._id}&page_num='+page, function(comment) { 
                if(comment.length>0){
                    var output = '';
                    $('.comment').empty();
                    output += '<textarea class="form-control", id="feedbackComment", rows="10", cols="45">'+comment+'</textarea>'
                    $('.comment').html(output);
                }else{
                    var output = '';
                    $('.comment').empty();
                    output += '<textarea class="form-control", id="feedbackComment", rows="10", cols="45"></textarea>'
                    $('.comment').html(output);
                }
            });

            $.ajax({
                url: '/feedbacks/page?id=#{feedback._id}&page_num='+page,
                type: "get",
                success: function(comment) {
                   if(comment.length>0){
                        var output = '';
                        $('.comment').empty();
                        output += '<textarea class="form-control", id="feedbackComment", rows="10", cols="45">'+comment+'</textarea>'
                        $('.comment').html(output);
                    }else{
                        var output = '';
                        $('.comment').empty();
                        output += '<textarea class="form-control", id="feedbackComment", rows="10", cols="45"></textarea>'
                        $('.comment').html(output);
                    }
                }
            });
        }
        function prevChange() {
            var page_num = document.getElementById("page_num").innerHTML;
            if(page_num==1) return;
            var page = page_num-1;
            $.get('/feedbacks/page?id=#{feedback._id}&page_num='+page, function(comment) { 
                if(comment.length>0){
                    var output = '';
                    $('.comment').empty();
                    output += '<textarea class="form-control", id="feedbackComment", rows="10", cols="45">'+comment+'</textarea>'
                    $('.comment').html(output);
                }else{
                    var output = '';
                    $('.comment').empty();
                    output += '<textarea class="form-control", id="feedbackComment", rows="10", cols="45"></textarea>'
                    $('.comment').html(output);
                }
            });

            $.ajax({
                url: '/feedbacks/page?id=#{feedback._id}&page_num='+page,
                type: "get",
                success: function(comment) {
                   if(comment.length>0){
                        var output = '';
                        $('.comment').empty();
                        output += '<textarea class="form-control", id="feedbackComment", rows="10", cols="45">'+comment+'</textarea>'
                        $('.comment').html(output);
                    }else{
                        var output = '';
                        $('.comment').empty();
                        output += '<textarea class="form-control", id="feedbackComment", rows="10", cols="45"></textarea>'
                        $('.comment').html(output);
                    }
                }
            });
            
        }